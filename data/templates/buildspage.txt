<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="https://i.ibb.co/2dX2WYW/atomism-ICONSSS.png">
    <title>City builds</title>
    <style>
        .template {
            display: inline-block;
            width: 320px;
            height: auto;
            margin: 20px;
            background-color: gainsboro;
        }

        .stat {
            display: inline-block;
            width: 100%;
        }

        .inline_block {
            display: inline-block;
            width: 30%;
            text-align:center;
        }

        .alert {
        padding: 20px;
        border-radius: 20px;
        background-color: orangered;
        color: white;
        font-size: small;
        }

        .closebtn {
        margin-left: 15px;
        color: white;
        font-weight: bold;
        float: right;
        font-size: 22px;
        line-height: 20px;
        cursor: pointer;
        transition: 0.3s;
        }

        .closebtn:hover {
        color: black;
        }

        .left {
            border:2px groove whitesmoke;
            border-radius: 5px;
            padding: 3px 5px 3px 5px;
            float: left;
            width: 45%
        }

        .right {
            border:2px groove whitesmoke;
            border-radius: 5px;
            padding: 3px 5px 3px 5px;
            float: right;
            width: 45%
        }
        
    </style>
    <script>
        function copyFunc(rs) {
            var str = document.getElementById(rs).innerHTML;
            const el = document.createElement('textarea');
            el.value = str;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
        }
    </script>
</head>
<body style="background-color: darkgray;font-family: Arial, Helvetica, sans-serif;font-size: 15px;">

<div>
    <div class="alert">
        <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span> 
        <strong>IMPORTANT!</strong> - This tool only shows builds that are currently being used somewhere in Orbis. This means that you may very well be able to improve upon these builds. It's worth mentioning that even though this shows the best builds for producing every type of resource (except for the ones you can't produce due to continent restrictions), the "best build for net income" is in reality best for every resource. This is because the higher monetary income lets you buy more of a resource than you could get by producing it. Another important thing to mention, is that the monetary net income is dependent on market prices. This means that in times of war, manufactured resources will increase in price, increasing the profitability of builds producing these resources. The "best" build for net income may therefore not always be the same.
      </div>
    % for rs in rss:
    <div class="template" id="template ${rs}" style="border:4px solid whitesmoke; padding: 0px 5px 5px 5px;">
    <h3 style="text-align:center;">The best build for ${rs}</h3>
    <pre id="${rs}" style="font-size: small;">${builds[rs]['template']}</pre>
        <div style="display: flex;justify-content: space-between;">
            <button onclick="copyFunc('${rs}')">
                Copy build
            </button>
            <form action="https://politicsandwar.com/cities/" target="_blank" style="display: inline-block;">
                <input type="submit" value="Your city page" />
            </form>
            <form action="https://politicsandwar.com/city/improvements/bulk-import/" target="_blank" style="display: inline-block;">
                <input type="submit" value="Bulk import page" />
            </form>
        </div>
        <div class="stat">
            <div class="left">
                ü§¢ = ${round(builds[rs]['disease_rate'], 1)}% (${round(builds[rs]['real_disease_rate'], 1)}%)
            </div>
            <div class="right">
                üè≠ = ${round(builds[rs]['pollution'])}pts (${round(builds[rs]['real_pollution'])}pts)
            </div>
            <br>
            <div class="left">
                üëÆ = ${round(builds[rs]['crime_rate'], 1)}% (${round(builds[rs]['real_crime_rate'], 1)}%)
            </div>
            <div class="right">
                üõí = ${round(builds[rs]['commerce'])}% (${round(builds[rs]['real_commerce'])}%)
            </div>
            <div class="left">
                MMR = ${f"{builds[rs]['barracks']}/{builds[rs]['factories']}/{builds[rs]['hangars']}/{builds[rs]['drydocks']}"}
            </div>
            <div class="right">
                Land = ${land}
            </div>
            <div style="border:2px groove whitesmoke; border-radius: 5px; padding: 3px 5px 3px 5px; display: inline-block; width: 306px">
                Net income = $${f"{round(builds[rs]['net income']):,}"}
            </div>
            <div style="border:2px groove whitesmoke; border-radius: 5px;padding:5px;max-width:fit-content">
                <div class="inline_block"><img src="https://i.ibb.co/Jvc721Q/aluminum.png" alt="aluminum"></a> = ${round(builds[rs]['aluminum'], 1)}</div>
                <div class="inline_block"><img src="https://i.ibb.co/MCX24BV/bauxite.png" alt="bauxite"></a> = ${round(builds[rs]['bauxite'], 1)}</div>
                <div class="inline_block"><img src="https://i.ibb.co/0Q49PQW/coal.png" alt="coal"></a> = ${round(builds[rs]['coal'], 1)}</div>
                <div class="inline_block"><img src="https://i.ibb.co/WyGLcnL/gasoline.png" alt="gasoline"></a> = ${round(builds[rs]['gasoline'], 1)}</div>
                <div class="inline_block"><img src="https://i.ibb.co/27cjVPf/iron.png" alt="iron"></a> = ${round(builds[rs]['iron'], 1)}</div>
                <div class="inline_block"><img src="https://i.ibb.co/r5KB1rS/lead.png" alt="lead"></a> = ${round(builds[rs]['lead'], 1)}</div>
                <div class="inline_block"><img src="https://i.ibb.co/cgd2D7s/money.png" alt="money"></a> = ${round(builds[rs]['money']/1000, 1)}k</div>
                <div class="inline_block"><img src="https://i.ibb.co/LJLjL7g/munitions.png" alt="munitions"></a> = ${round(builds[rs]['munitions'], 1)}</div>
                <div class="inline_block"><img src="https://i.ibb.co/861z21m/oil.png" alt="oil"></a> = ${round(builds[rs]['oil'], 1)}</div>
                <div class="inline_block"><img src="https://i.ibb.co/PcbqzMS/steak-meat.png" alt="steak-meat"></a> = ${round(builds[rs]['food'], 1)}</div>
                <div class="inline_block"><img src="https://i.ibb.co/JHVBnW7/steel.png" alt="steel"></a> = ${round(builds[rs]['steel'], 1)}</div>
                <div class="inline_block"><img src="https://i.ibb.co/JB3dhNQ/uranium.png" alt="uranium"></a> = ${round(builds[rs]['uranium'], 1)}</div>
            </div>
        </div>
        <div class="left_btn" style="float: left;">
            <button onclick="leftFunc('${rs}')" style="width: 100px;">
                <span class="tooltiptext" id="myTooltip">Previous</span>
            </button>
        </div>
        <div class="count" id="count ${rs}" style="text-align: center;width: 120px;display: inline-block;">
            #1
        </div>
        <div class="right_btn" style="float: right;">
            <button onclick="rightFunc('${rs}')" style="width: 100px;">
                <span class="tooltiptext" id="myTooltip">Next</span>
            </button>
        </div>
    </div>
    % endfor
</div>
</body>
<script>
    var builds = ${unique_builds}
    var land = ${land}

    function formatNumber(num) {
        return num.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1,')
    }

    function rightFunc(rs) {
        console.log(rs)
        builds.sort((firstItem, secondItem) => secondItem['net income'] - firstItem['net income']);
        builds.sort((firstItem, secondItem) => secondItem[rs] - firstItem[rs]);
        var index = parseInt(document.getElementById("count " + rs).textContent.replace(/\D/g,'')) + 1
        var build = builds[index-1]
        templateMaker(build, rs, index)
    }

    function leftFunc(rs) {
        console.log(rs)
        builds.sort((firstItem, secondItem) => secondItem['net income'] - firstItem['net income']);
        builds.sort((firstItem, secondItem) => secondItem[rs] - firstItem[rs]);
        var index = parseInt(document.getElementById("count " + rs).textContent.replace(/\D/g,'')) - 1
        var build = builds[index-1]
        templateMaker(build, rs, index)
    }

    function templateMaker(build, rs, index) {
        var str = `
        <div class="template" id="template <%text>$</%text>{rs}" style="border:4px solid whitesmoke; padding: 0px 5px 5px 5px;">
        <h3 style="text-align:center;">The best build for <%text>$</%text>{rs}</h3>
    <pre id="<%text>$</%text>{rs}" style="font-size: small;">
{
    "infra_needed": <%text>$</%text>{build['infrastructure']},
    "imp_total": <%text>$</%text>{Math.floor(parseFloat(build['infrastructure'])/50)},
    "imp_coalpower": <%text>$</%text>{build['coal_power_plants']},
    "imp_oilpower": <%text>$</%text>{build['oil_power_plants']},
    "imp_windpower": <%text>$</%text>{build['wind_power_plants']},
    "imp_nuclearpower": <%text>$</%text>{build['nuclear_power_plants']},
    "imp_coalmine": <%text>$</%text>{build['coal_mines']},
    "imp_oilwell": <%text>$</%text>{build['oil_wells']},
    "imp_uramine": <%text>$</%text>{build['uranium_mines']},
    "imp_leadmine": <%text>$</%text>{build['lead_mines']},
    "imp_ironmine": <%text>$</%text>{build['iron_mines']},
    "imp_bauxitemine": <%text>$</%text>{build['bauxite_mines']},
    "imp_farm": <%text>$</%text>{build['farms']},
    "imp_gasrefinery": <%text>$</%text>{build['oil_refineries']},
    "imp_aluminumrefinery": <%text>$</%text>{build['aluminum_refineries']},
    "imp_munitionsfactory": <%text>$</%text>{build['munitions_factories']},
    "imp_steelmill": <%text>$</%text>{build['steel_mills']},
    "imp_policestation": <%text>$</%text>{build['police_stations']},
    "imp_hospital": <%text>$</%text>{build['hospitals']},
    "imp_recyclingcenter": <%text>$</%text>{build['recycling_centers']},
    "imp_subway": <%text>$</%text>{build['subway']},
    "imp_supermarket": <%text>$</%text>{build['supermarkets']},
    "imp_bank": <%text>$</%text>{build['banks']},
    "imp_mall": <%text>$</%text>{build['shopping_malls']},
    "imp_stadium": <%text>$</%text>{build['stadiums']},
    "imp_barracks": <%text>$</%text>{build['barracks']},
    "imp_factory": <%text>$</%text>{build['factories']},
    "imp_hangars": <%text>$</%text>{build['hangars']},
    "imp_drydock": <%text>$</%text>{build['drydocks']}
}</pre>
        <div style="display: flex;justify-content: space-between;">
            <button onclick="copyFunc('<%text>$</%text>{rs}')">
                Copy build
            </button>
            <form action="https://politicsandwar.com/cities/" target="_blank" style="display: inline-block;">
                <input type="submit" value="Your city page" />
            </form>
            <form action="https://politicsandwar.com/city/improvements/bulk-import/" target="_blank" style="display: inline-block;">
                <input type="submit" value="Bulk import page" />
            </form>
        </div>
        <div class="stat">
            <div class="left">
                ü§¢ = <%text>$</%text>{Math.round(build['disease_rate'] * 10) / 10}% (<%text>$</%text>{Math.round(build['real_disease_rate'] * 10) / 10}%)
            </div>
            <div class="right">
                üè≠ = <%text>$</%text>{build['pollution']}pts (<%text>$</%text>{build['real_pollution']}pts)
            </div>
            <br>
            <div class="left">
                üëÆ = <%text>$</%text>{Math.round(build['crime_rate'] * 10) / 10}% (<%text>$</%text>{Math.round(build['real_crime_rate'] * 10) / 10}%)
            </div>
            <div class="right">
                üõí = <%text>$</%text>{build['commerce']}% (<%text>$</%text>{build['real_commerce']}%)
            </div>
            <div class="left">
                MMR = <%text>$</%text>{build['barracks']}/<%text>$</%text>{build['factories']}/<%text>$</%text>{build['hangars']}/<%text>$</%text>{build['drydocks']}
            </div>
            <div class="right">
                Land = <%text>$</%text>{land}
            </div>
            <div style="border:2px groove whitesmoke; border-radius: 5px; padding: 3px 5px 3px 5px; display: inline-block; width: 306px">
                Net income = <%text>$</%text><%text>$</%text>{formatNumber(build['net income'])}
            </div>
            <div style="border:2px groove whitesmoke; border-radius: 5px;padding:5px;max-width:fit-content">
                <div class="inline_block"><img src="https://i.ibb.co/Jvc721Q/aluminum.png" alt="aluminum"></a> = <%text>$</%text>{parseFloat(build['aluminum']).toFixed(1)}</div>
                <div class="inline_block"><img src="https://i.ibb.co/MCX24BV/bauxite.png" alt="bauxite"></a> = <%text>$</%text>{parseFloat(build['bauxite']).toFixed(1)}</div>
                <div class="inline_block"><img src="https://i.ibb.co/0Q49PQW/coal.png" alt="coal"></a> = <%text>$</%text>{parseFloat(build['coal']).toFixed(1)}</div>
                <div class="inline_block"><img src="https://i.ibb.co/WyGLcnL/gasoline.png" alt="gasoline"></a> = <%text>$</%text>{parseFloat(build['gasoline']).toFixed(1)}</div>
                <div class="inline_block"><img src="https://i.ibb.co/27cjVPf/iron.png" alt="iron"></a> = <%text>$</%text>{parseFloat(build['iron']).toFixed(1)}</div>
                <div class="inline_block"><img src="https://i.ibb.co/r5KB1rS/lead.png" alt="lead"></a> = <%text>$</%text>{parseFloat(build['lead']).toFixed(1)}</div>
                <div class="inline_block"><img src="https://i.ibb.co/cgd2D7s/money.png" alt="money"></a> = <%text>$</%text>{parseFloat(build['money']/1000).toFixed(1)}k</div>
                <div class="inline_block"><img src="https://i.ibb.co/LJLjL7g/munitions.png" alt="munitions"></a> = <%text>$</%text>{parseFloat(build['munitions']).toFixed(1)}</div>
                <div class="inline_block"><img src="https://i.ibb.co/861z21m/oil.png" alt="oil"></a> = <%text>$</%text>{parseFloat(build['oil']).toFixed(1)}</div>
                <div class="inline_block"><img src="https://i.ibb.co/PcbqzMS/steak-meat.png" alt="steak-meat"></a> = <%text>$</%text>{parseFloat(build['food']).toFixed(1)}</div>
                <div class="inline_block"><img src="https://i.ibb.co/JHVBnW7/steel.png" alt="steel"></a> = <%text>$</%text>{parseFloat(build['steel']).toFixed(1)}</div>
                <div class="inline_block"><img src="https://i.ibb.co/JB3dhNQ/uranium.png" alt="uranium"></a> = <%text>$</%text>{parseFloat(build['uranium']).toFixed(1)}</div>
            </div>
        </div>
        <div class="left_btn" style="float: left;">
            <button onclick="leftFunc('<%text>$</%text>{rs}')" style="width: 100px;">
                <span class="tooltiptext" id="myTooltip">Previous</span>
            </button>
        </div>
        <div class="count" id="count <%text>$</%text>{rs}" style="text-align: center;width: 120px;display: inline-block;">
            #<%text>$</%text>{index}
        </div>
        <div class="right_btn" style="float: right;">
            <button onclick="rightFunc('<%text>$</%text>{rs}')" style="width: 100px;">
                <span class="tooltiptext" id="myTooltip">Next</span>
            </button>
        </div>
</div>`
        console.log()
        var Obj = document.getElementById(`template <%text>$</%text>{rs}`); //any element to be fully replaced
        if(Obj.outerHTML) { //if outerHTML is supported
            Obj.outerHTML=str; ///it's simple replacement of whole element with contents of str var
        }
        else { //if outerHTML is not supported, there is a weird but crossbrowsered trick
            var tmpObj=document.createElement("div");
            tmpObj.innerHTML='<!--THIS DATA SHOULD BE REPLACED-->';
            ObjParent=Obj.parentNode; //Okey, element should be parented
            ObjParent.replaceChild(tmpObj,Obj); //here we placing our temporary data instead of our target, so we can find it then and replace it into whatever we want to replace to
            ObjParent.innerHTML=ObjParent.innerHTML.replace('<div><!--THIS DATA SHOULD BE REPLACED--></div>',str);
        }

    }
</script>
</html>